#!/bin/bash

# Script за рестартиране на контейнера и зареждане на .env променливите
# Използвай: bash reload-env.sh

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "🔄 Рестартиране на контейнера"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""

echo "⏹️  Спиране на контейнера..."
docker compose down app

echo ""
echo "▶️  Стартиране на контейнера с новите .env променливи..."
docker compose up -d app

echo ""
echo "⏳ Изчакване контейнерът да се стартира (5 секунди)..."
sleep 5

echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "📧 Проверка на конфигурацията"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""

# Проверка дали контейнерът работи
if ! docker ps --format '{{.Names}}' | grep -q "^metalworking-app$"; then
    echo "❌ Грешка: Контейнерът не работи!"
    exit 1
fi

docker exec metalworking-app php check-email-config.php

echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "✅ Готово!"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
